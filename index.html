<!doctype html>
<html lang="mk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Пронајди го паметното греење за твојот дом</title>
<meta name="description" content="Одговори на 8 кратки прашања и добиј бесплатна проценка колку би чинела идеалната Samsung топлотна пумпа за твојот дом." />
<style>
  :root{
    --bg:#ffffff; --text:#111827; --muted:#6b7280; --border:#e5e7eb; --card:#ffffff;
    --accent:#E2231A; --radius:16px; --shadow:0 10px 30px rgba(0,0,0,.06);
    --error:#dc2626;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif}
  img{max-width:100%;display:block}
  .wrap{min-height:100dvh;display:flex;flex-direction:column}
  header{position:sticky;top:0;background:rgba(255,255,255,.85);backdrop-filter:blur(6px);border-bottom:1px solid var(--border);z-index:10}
  .container{max-width:980px;margin:0 auto;padding:16px}
  .logo{display:flex;justify-content:center;align-items:center;height:64px}
  .logo img{height:40px;object-fit:contain}

  .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}

  /* Welcome card (image above text) */
  .welcome{overflow:hidden}
  .welcome .hero-img{width:100%;height:auto;display:block}
  .welcome .content{padding:18px}
  h1{font-size:clamp(22px,4.5vw,36px);margin:0 0 8px}
  p.lead{font-size:clamp(14px,3.8vw,18px);opacity:.95;margin:0 0 16px}
  .btn{display:inline-flex;align-items:center;gap:8px;background:var(--accent);color:#fff;border:none;border-radius:999px;padding:12px 18px;font-weight:700;cursor:pointer;transition:transform .05s ease;box-shadow:0 6px 16px rgba(226,35,26,.3);text-decoration:none}
  .btn:active{transform:translateY(1px)}
  .btn[disabled]{opacity:.6;cursor:default}
  .btn-secondary{background:#fff;color:var(--accent);border:1px solid var(--accent)}

  /* Quiz */
  .quiz{padding:18px 16px 90px}
  .progress{height:8px;background:#f3f4f6;border-radius:999px;overflow:hidden;margin:8px 0 16px}
  .progress>span{display:block;height:100%;background:var(--accent);width:0%;transition:width .25s}
  .q-title{font-size:22px;font-weight:800;margin:4px 0 12px}
  .q-sub{color:var(--muted);margin:0 0 12px;font-size:14px}

  /* Uniform cards (no icons) */
  /* auto-fit makes all option cards equal-width columns across steps */
  .grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(180px,1fr))}
  .opt{
    display:flex;justify-content:center;align-items:center;text-align:center;
    padding:14px;border:1px solid var(--border);border-radius:12px;background:#fff;
    cursor:pointer;transition:border-color .15s, box-shadow .15s; min-height:60px; width:100%;
  }
  .opt:hover{border-color:#d1d5db;box-shadow:0 8px 18px rgba(0,0,0,.06)}
  .opt[data-selected='true']{border-color:var(--accent);box-shadow:0 0 0 3px rgba(226,35,26,.15)}
  .field{display:flex;flex-direction:column;gap:6px}
  .input{padding:12px 12px;border:1px solid var(--border);border-radius:12px;font-size:16px}
  .input.error{border-color:var(--error); box-shadow:0 0 0 3px rgba(220,38,38,.12)}
  .error-text{font-size:12px;color:var(--error);margin-top:4px}
  .row{display:grid;gap:10px;grid-template-columns:1fr}
  @media(min-width:560px){ .row-3{grid-template-columns:2fr 1fr 1fr} }
  .consent{display:flex;gap:10px;align-items:flex-start;margin-top:8px;font-size:13px;color:#374151}
  .consent input{margin-top:3px}
  .nav{display:flex;justify-content:space-between;gap:10px;margin-top:14px}
  .hidden{display:none !important}

  /* Success (image on top like welcome) */
  .success-card .hero-img{width:100%;height:auto;display:block}
  .success-card .content{padding:18px}
  .phone-btn{margin-top:10px}

  footer{text-align:center;color:#6b7280;font-size:12px;padding:18px}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="container">
        <div class="logo">
          <img src="https://invensis.com.mk/wp-content/uploads/2023/04/cropped-cropped-cropped-logo-2ki-e1680670915655.png" alt="Invensis logo" />
        </div>
      </div>
    </header>

    <main class="container">
      <!-- Welcome -->
      <section id="welcome" class="card welcome">
        <img class="hero-img" src="https://i.postimg.cc/8CPTy5fc/Vizual-1.png" alt="Samsung топлотна пумпа - дом">
        <div class="content">
          <h1>Пронајди го нај паметното греење за твојот дом за 30 секунди.</h1>
          <p class="lead">Одговори на 8 кратки прашања и добиј бесплатна проценка колку би чинела идеалната Samsung топлотна пумпа за твојот дом.</p>
          <button class="btn" id="startBtn">Започни →</button>
        </div>
      </section>

      <!-- Quiz -->
      <section id="quiz" class="quiz hidden">
        <div class="progress"><span id="progressBar"></span></div>
        <div id="qArea" class="card" style="padding:14px"></div>
        <div class="nav">
          <button class="btn btn-secondary" id="backBtn">Назад</button>
          <button class="btn" id="nextBtn">следно</button>
        </div>
      </section>

      <!-- Success -->
      <section id="success" class="card success-card hidden">
        <img class="hero-img" src="https://i.postimg.cc/HLsTSx8J/vizual-2.png" alt="Успешно поднесена проценка">
        <div class="content">
          <h1>Благодариме, твојата бесплатна проценка е примена!</h1>
          <p class="lead">Нашиот тим од Invensis ќе те контактира во најкус можен рок за да направиме точна проценка за твојот дом.</p>
          <a class="btn btn-secondary phone-btn" href="tel:+38923254355">Јави се веднаш</a>
        </div>
      </section>
    </main>

    <footer>© 2025 Invensis - Контакт: +389 (0) 2 3254 355</footer>
  </div>

<script>
/* ====== GOOGLE SHEETS WEB APP URL ====== */
const GAS_URL = "https://script.google.com/macros/s/AKfycbw_mannm2Ur9ZolrFy57A9Y2y3mEf5TwUKc28LRsDmBHGIbu8hTWwDBCYqqodmp8Hmk/exec";
/* ======================================= */

let step = 0;
const answers = { utm_source: new URLSearchParams(location.search).get('utm_source')||'' };

const startBtn = document.getElementById('startBtn');
const welcome = document.getElementById('welcome');
const quiz = document.getElementById('quiz');
const success = document.getElementById('success');
const qArea = document.getElementById('qArea');
const backBtn = document.getElementById('backBtn');
const nextBtn = document.getElementById('nextBtn');
const progressBar = document.getElementById('progressBar');

/* Steps (no icons) */
const steps = [
  { key:'home_type', title:'Каков дом имаш?', render: () => cardGrid([
    'Куќа','Двокатна куќа','Стан','Друго'
  ]) },
  { key:'size', title:'Колкава е квадратурата на твојот дом?', render: () => cardGrid([
    'Под 100m²','100 - 150m²','150 - 200m²','Над 200m²'
  ]) },
  { key:'current_heating', title:'Како моментално се грееш?', render: () => cardGrid([
    'Клима уред','Парно / електричен котел','Дрва','Пелети','Комбинирано','Немам систем, барам ново решение'
  ]) },
  { key:'timeline', title:'Кога планираш да го поставиш новиот систем за греење?', render: () => cardGrid([
    'Што поскоро (во наредниве 30 дена)','Во следните 2-3 месеци','Во следните 6 месеци','Само разгледувам опции'
  ]) },
  { key:'financing', title:'Како планираш да платиш?', render: () => cardGrid([
    'Ќе платам во готово','Сакам да видам опција за плаќање на рати','Сè уште не сум сигурен - сакам совет'
  ]) },
  { key:'address', title:'Внеси ја адресата на твојот дом', render: () => formAddress() },
  { key:'contact', title:'Последен чекор — за да ти ја испратиме проценката', render: () => formContact() },
];

function cardGrid(labels){
  const opts = labels.map(label =>
    '<div class="opt" data-value="'+label+'" onclick="selectOption(\''+label.replace(/"/g,'&quot;')+'\', this)">'+
      '<div>'+label+'</div></div>'
  ).join('');
  return '<div class="q-title"></div><div class="grid">'+opts+'</div>';
}

function formAddress(){
  const v = answers.address||{};
  return ''
   + '<div class="field">'
   + '<label class="q-sub">Адреса</label>'
   + '<input id="addr" class="input" placeholder="Ул. Пример 12" value="'+(v.addr||'')+'" required>'
   + '</div>'
   + '<div class="row row-3" style="margin-top:10px">'
   +   '<div class="field"><label class="q-sub">Град</label>'
   +   '<input id="city" class="input" placeholder="Скопје" value="'+(v.city||'')+'" required></div>'
   +   '<div class="field"><label class="q-sub">Поштенски код</label>'
   +   '<input id="zip" class="input" placeholder="1000" value="'+(v.zip||'')+'" pattern="\\d{4}" required></div>'
   + '</div>';
}

function formContact(){
  const v = answers.contact||{};
  return ''
   + '<div class="field"><label class="q-sub">Име и презиме</label>'
   + '<input id="fullName" class="input" placeholder="Име Презиме" value="'+(v.name||'')+'" required></div>'
   + '<div class="row" style="margin-top:10px">'
   +   '<div class="field"><label class="q-sub">Телефон (опционално)</label>'
   +   '<input id="phone" class="input" placeholder="+389 7x xxx xxx" value="'+(v.phone||'')+'"></div>'
   +   '<div class="field"><label class="q-sub">Е-пошта</label>'
   +   '<input id="email" class="input" type="email" placeholder="you@example.com" value="'+(v.email||'')+'" required></div>'
   + '</div>'
   + '<label class="consent"><input id="consent" type="checkbox" required> <span>Со испраќање на формуларот, се согласувам моите податоци да бидат користени за контакт и изработка на персонализирана понуда.</span></label>'
   + '<div id="contactErrors" class="error-text" style="display:none"></div>';
}

function setProgress(){ progressBar.style.width = ((step+1)/steps.length*100)+'%'; }

function render(){
  setProgress();
  const s = steps[step];
  qArea.innerHTML = '<div class="q-title">'+s.title+'</div>' + s.render();
  nextBtn.textContent = step === steps.length-1 ? 'Испрати и добиј бесплатна проценка →' : 'следно';
  backBtn.style.visibility = step===0 ? 'hidden' : 'visible';
  if(['home_type','size','current_heating','timeline','financing'].includes(s.key) && answers[s.key]) {
    [...qArea.querySelectorAll('.opt')].forEach(d=>{ if(d.dataset.value===answers[s.key]) d.setAttribute('data-selected','true'); });
  }
}

window.selectOption = (label, el) => {
  [...qArea.querySelectorAll('.opt')].forEach(d=>d.removeAttribute('data-selected'));
  el.setAttribute('data-selected','true');
  const key = steps[step].key;
  answers[key] = label;
};

function clearErrors(){
  qArea.querySelectorAll('.input').forEach(i=>i.classList.remove('error'));
  const ct = qArea.querySelector('#contactErrors');
  if (ct){ ct.style.display='none'; ct.textContent=''; }
}

function scrollToEl(el){
  const y = el.getBoundingClientRect().top + window.scrollY - 90;
  window.scrollTo({ top:y, behavior:'smooth' });
}

function validatePhoneOptional(value){
  if (!value) return true; // optional
  // Accept +389 7x xxx xxx or 07x xxx xxx (common MK mobiles, flexible spaces)
  const re = /^(?:\+389\s?7\d\s?\d{3}\s?\d{3}|0?7\d\s?\d{3}\s?\d{3})$/;
  return re.test(value.trim());
}

function validateEmail(value){
  // Rely on type=email + a conservative regex fallback
  const re = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/;
  return re.test(value.trim());
}

function validateStep(){
  clearErrors();
  const key = steps[step].key;
  if(['home_type','size','current_heating','timeline','financing'].includes(key)) return !!answers[key];

  if(key==='address'){
    const addr = qArea.querySelector('#addr');
    const city = qArea.querySelector('#city');
    const zip = qArea.querySelector('#zip');
    const validZip = /^\d{4}$/.test(zip.value.trim());
    let ok = true;
    if(!addr.value.trim()){ addr.classList.add('error'); ok=false; }
    if(!city.value.trim()){ city.classList.add('error'); ok=false; }
    if(!validZip){ zip.classList.add('error'); ok=false; }
    if(!ok){
      const bad = qArea.querySelector('.input.error');
      if (bad) scrollToEl(bad);
      return false;
    }
    answers.address = {addr:addr.value.trim(), city:city.value.trim(), zip:zip.value.trim()};
    return true;
  }

  if(key==='contact'){
    const name = qArea.querySelector('#fullName');
    const phone = qArea.querySelector('#phone');
    const email = qArea.querySelector('#email');
    const consent = qArea.querySelector('#consent');
    const errBox = qArea.querySelector('#contactErrors');

    let msgs = [];
    if(!name.value.trim()){ name.classList.add('error'); msgs.push('Името е задолжително.'); }
    if(!validateEmail(email.value)){ email.classList.add('error'); msgs.push('Внесете валидна е-пошта.'); }
    if(!validatePhoneOptional(phone.value)){ phone.classList.add('error'); msgs.push('Телефонот мора да биде +389 7x xxx xxx или 07x xxx xxx.'); }
    if(!consent.checked){ msgs.push('Морате да се согласите со обработка на податоците.'); }

    if(msgs.length){
      errBox.textContent = msgs.join(' ');
      errBox.style.display = 'block';
      const bad = qArea.querySelector('.input.error') || consent;
      scrollToEl(bad);
      return false;
    }
    answers.contact = {name:name.value.trim(), phone:phone.value.trim(), email:email.value.trim()};
    return true;
  }

  return true;
}

async function submitForm(){
  nextBtn.disabled = true;
  nextBtn.textContent = 'Се испраќа…';
  try {
    const payload = {
      timestamp: new Date().toISOString(),
      home_type: answers.home_type||'',
      size: answers.size||'',
      current_heating: answers.current_heating||'',
      timeline: answers.timeline||'',
      financing: answers.financing||'',
      address: answers.address?.addr||'',
      city: answers.address?.city||'',
      zip: answers.address?.zip||'',
      name: answers.contact?.name||'',
      phone: answers.contact?.phone||'',
      email: answers.contact?.email||'',
      user_agent: navigator.userAgent,
      referrer: document.referrer,
    };

    if(!GAS_URL || GAS_URL.startsWith('REPLACE_')) throw new Error('Missing Google Apps Script URL');

    // text/plain: simpler, avoids CORS preflight
    const res = await fetch(GAS_URL, {
      method:'POST',
      headers:{'Content-Type':'text/plain;charset=utf-8'},
      body: JSON.stringify(payload)
    });

    if(!res.ok) throw new Error('Bad response');
    showSuccess();
  } catch(e) {
    alert('Настана грешка при испраќањето. Ве молиме обидете се повторно.');
    nextBtn.disabled = false;
    nextBtn.textContent = 'следно';
  }
}

function showSuccess(){
  quiz.classList.add('hidden');
  success.classList.remove('hidden');
  window.scrollTo({top:0, behavior:'smooth'});
}

startBtn?.addEventListener('click', ()=>{
  welcome.classList.add('hidden');
  quiz.classList.remove('hidden');
  step = 0;
  render();
});
backBtn.addEventListener('click', ()=>{ if(step>0){ step--; render(); } });
nextBtn.addEventListener('click', ()=>{
  if(!validateStep()) return;
  if(step < steps.length-1) { step++; render(); }
  else submitForm();
});
</script>
</body>
</html>
